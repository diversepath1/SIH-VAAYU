<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Delhi AQI Dashboard</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <!-- Flatpickr CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Font Awesome -->
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

  <style>
    :root { --crimson: #DC143C; }
    body { font-family: Arial, sans-serif; background: #f8f9fa; }
    h2 { text-align: center; margin: 20px 0; color: var(--crimson); }
    #routeMap { height: 500px; border-radius: 12px; }
    #pmChart { background: white; border-radius: 12px; padding: 10px; }
    .card { border: none; box-shadow: 0 4px 8px rgba(0,0,0,0.05); }
    .form-control:focus { box-shadow: 0 0 0 0.2rem rgba(220,20,60,.25); border-color: var(--crimson); }
    .btn-crimson { background-color: var(--crimson); color: #fff; }
    .btn-crimson:hover { background-color: #b01030; color: #fff; }
  </style>
</head>

<body>
  <div class="container-fluid">
    <h2><i class="fas fa-city"></i> Delhi AQI Dashboard</h2>

    <div class="row">
      <!-- Left Panel -->
      <div class="col-md-4">
        <!-- Route Planner -->
        <div class="card my-3 p-3" style="border-radius:12px; background: #e3f2fd;">
          <h5><i class="fas fa-route text-primary"></i> Plan Your Route</h5>
          <input type="text" id="source" class="form-control mb-2" placeholder="Source (A-D)">
          <input type="text" id="destination" class="form-control mb-2" placeholder="Destination (A-D)">
          
          <select id="travelMode" class="form-select mb-2">
            <option value="walk">Walk</option>
            <option value="bike">Bike</option>
            <option value="car">Car</option>
          </select>

          <div class="form-check mb-2">
            <input type="checkbox" class="form-check-input" id="preferScenic">
            <label class="form-check-label" for="preferScenic">Prefer Scenic / Tourist Spots</label>
          </div>

          <button id="calculateRouteBtn" class="btn btn-crimson w-100 mb-3">
            <i class="fas fa-map-marked-alt"></i> Calculate Route
          </button>
        </div>

        <!-- Health Alerts -->
        <div class="card my-3 p-3" style="border-radius:12px; background: #fff3cd; border-left:6px solid #ffc107;">
          <h5><i class="fas fa-heartbeat text-warning"></i> Real-Time Health Alerts</h5>
          <ul id="healthAlerts" class="list-group list-group-flush">
            <li class="list-group-item">No alerts yet</li>
          </ul>
        </div>

        <!-- Smart Calendar -->
        <div class="card my-3 p-3" style="border-radius:12px; background: #e6ffe6;">
          <h5><i class="fas fa-calendar-alt text-success"></i> Smart AQI Calendar</h5>
          <div id="smartCalendar"></div>
        </div>
      </div>

      <!-- Right Panel: Map + Chart -->
      <div class="col-md-8">
        <div id="routeMap" class="my-3"></div>
        <canvas id="pmChart" class="my-3"></canvas>
      </div>
    </div>
  </div>

  <!-- Dependencies -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

  <!-- Smart Calendar Setup -->
  <script>
    // Dummy AQI data for specific dates
    const aqiDates = {
      "2025-09-20": 180,
      "2025-09-21": 150,
      "2025-09-22": 210,
      "2025-09-23": 90
    };

    flatpickr("#smartCalendar", {
      inline: true,
      enable: Object.keys(aqiDates),
      onDayCreate: function(dObj, dStr, fp, dayElem) {
        const dateStr = dayElem.dateObj.toISOString().split('T')[0];
        if (aqiDates[dateStr]) {
          const aqi = aqiDates[dateStr];
          const color = aqi<=50?'green':aqi<=100?'yellow':aqi<=150?'orange':aqi<=200?'red':aqi<=300?'purple':'maroon';
          dayElem.style.backgroundColor = color;
          dayElem.style.color = 'white';
          dayElem.title = `AQI: ${aqi}`;
        }
      }
    });
  </script>

  <!-- PM2.5 Chart Setup -->
  <script>
    const hours = Array.from({length:24}, (_,i)=>i+":00");
    const pmCurrent = [120,130,140,150,160,170,180,190,200,210,220,210,200,190,180,170,160,150,140,130,120,110,100,90];
    const pmPrevYear = [100,110,120,130,140,150,160,170,180,190,200,190,180,170,160,150,140,130,120,110,100,90,80,70];

    const ctx = document.getElementById('pmChart').getContext('2d');
    const pmChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: hours,
        datasets: [
          {
            label: 'Current Year PM2.5',
            data: pmCurrent,
            borderColor: 'red',
            backgroundColor: 'rgba(255,0,0,0.1)',
            tension: 0.3,
            fill: true
          },
          {
            label: 'Previous Year PM2.5',
            data: pmPrevYear,
            borderColor: 'blue',
            backgroundColor: 'rgba(0,0,255,0.1)',
            tension: 0.3,
            fill: true
          }
        ]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'top' },
          title: { display: true, text: 'Hourly PM2.5 Comparison (Current vs Previous Year)' },
          tooltip: {
            callbacks: {
              label: function(context){
                let val = context.raw;
                let alert = val>200?" ⚠️ High Pollution!":"";
                return `${context.dataset.label}: ${val}${alert}`;
              }
            }
          }
        },
        scales: {
          y: { beginAtZero: true, title: { display: true, text: 'µg/m³' } },
          x: { title: { display: true, text: 'Hour' } }
        }
      }
    });
  </script>

  <!-- Custom Logic -->
  <script src="/citizen.js"></script>
</body>
</html>
